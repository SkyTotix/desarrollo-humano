<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prism - Tu Compa√±ero de Bienestar Emocional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #f0f9ff 100%);
            background-size: 400% 400%;
            animation: subtleGradientShift 20s ease infinite;
        }
        
        @keyframes subtleGradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #06D6A0 0%, #118AB2 50%, #0891b2 100%);
            background-size: 200% 200%;
            animation: headerGradient 10s ease infinite;
            position: relative;
            overflow: hidden;
        }
        
        .gradient-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes headerGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .card-hover {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .card-hover::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(6, 214, 160, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(6, 214, 160, 0.1);
        }
        
        .card-hover:hover::before {
            left: 100%;
        }
        
        .tool-active {
            background: linear-gradient(135deg, #06D6A0, #118AB2, #0891b2);
            background-size: 200% 200%;
            animation: activeGlow 2s ease infinite;
            color: white;
            box-shadow: 0 0 20px rgba(6, 214, 160, 0.4);
        }
        
        @keyframes activeGlow {
            0% { background-position: 0% 50%; box-shadow: 0 0 20px rgba(6, 214, 160, 0.4); }
            50% { background-position: 100% 50%; box-shadow: 0 0 30px rgba(17, 138, 178, 0.6); }
            100% { background-position: 0% 50%; box-shadow: 0 0 20px rgba(6, 214, 160, 0.4); }
        }
        
        .progress-bar {
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .fade-in {
            animation: fadeInUp 0.6s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .pulse-gentle {
            animation: pulseGentle 2s ease-in-out infinite;
        }
        
        @keyframes pulseGentle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .nav-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .nav-btn:hover::before {
            left: 100%;
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .quick-action-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .quick-action-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(6, 214, 160, 0.1) 0%, transparent 70%);
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
        }
        
        .quick-action-btn:hover::after {
            width: 300px;
            height: 300px;
        }
        
        .quick-action-btn:hover {
            transform: translateY(-5px) scale(1.05);
            border-color: #06D6A0;
            box-shadow: 0 15px 30px rgba(6, 214, 160, 0.2);
        }
        
        .section-content {
            animation: sectionFadeIn 0.5s ease-out;
        }
        
        @keyframes sectionFadeIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .breathing-circle {
            transition: all 0.3s ease;
        }
        
        .breathing-circle.inhale {
            transform: scale(1.5);
            background: linear-gradient(135deg, #06D6A0, #118AB2);
            box-shadow: 0 0 50px rgba(6, 214, 160, 0.6);
        }
        
        .breathing-circle.hold {
            transform: scale(1.5);
            background: linear-gradient(135deg, #118AB2, #0891b2);
            box-shadow: 0 0 60px rgba(17, 138, 178, 0.7);
        }
        
        .breathing-circle.exhale {
            transform: scale(1);
            background: linear-gradient(135deg, #0891b2, #06D6A0);
            box-shadow: 0 0 30px rgba(8, 145, 178, 0.4);
        }
        
        .walking-animation {
            transition: all 0.5s ease;
        }
        
        .walking-animation.walking-active {
            animation: walkingBounce 1s ease-in-out infinite;
        }
        
        @keyframes walkingBounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.1); }
        }
        
        .music-visualizer {
            display: flex;
            align-items: end;
            justify-content: center;
            gap: 4px;
            height: 60px;
        }
        
        .music-bar {
            width: 6px;
            background: linear-gradient(to top, #06D6A0, #118AB2);
            border-radius: 3px;
            transition: height 0.1s ease;
        }
        
        .music-visualizer.music-active .music-bar {
            animation: musicPulse 0.5s ease-in-out infinite alternate;
        }
        
        .music-visualizer.music-active .music-bar:nth-child(1) { animation-delay: 0s; }
        .music-visualizer.music-active .music-bar:nth-child(2) { animation-delay: 0.1s; }
        .music-visualizer.music-active .music-bar:nth-child(3) { animation-delay: 0.2s; }
        .music-visualizer.music-active .music-bar:nth-child(4) { animation-delay: 0.3s; }
        .music-visualizer.music-active .music-bar:nth-child(5) { animation-delay: 0.4s; }
        .music-visualizer.music-active .music-bar:nth-child(6) { animation-delay: 0.2s; }
        .music-visualizer.music-active .music-bar:nth-child(7) { animation-delay: 0.1s; }
        
        @keyframes musicPulse {
            0% { height: 10px; }
            100% { height: 50px; }
        }
        
        .music-suggestion {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .music-suggestion:hover {
            transform: scale(1.05);
            background: linear-gradient(135deg, #06D6A0, #118AB2);
            color: white;
        }
        
        .music-suggestion.selected {
            background: linear-gradient(135deg, #06D6A0, #118AB2);
            color: white;
            box-shadow: 0 0 20px rgba(6, 214, 160, 0.4);
        }
        
        .notification {
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .modal-backdrop {
            backdrop-filter: blur(5px);
            animation: backdropFadeIn 0.3s ease;
        }
        
        @keyframes backdropFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            animation: modalSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .glow-effect {
            box-shadow: 0 0 20px rgba(6, 214, 160, 0.3);
            transition: box-shadow 0.3s ease;
        }
        
        .glow-effect:hover {
            box-shadow: 0 0 30px rgba(6, 214, 160, 0.5);
        }

        /* Additional utility classes */
        .fade-in {
            animation: fadeInUp 0.8s ease-out forwards;
            opacity: 0;
        }

        .section-content {
            animation: sectionFadeIn 0.6s ease-out;
        }

        /* Enhanced hover effects */
        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .quick-action-btn:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="gradient-bg text-white py-6 px-4">
        <div class="container mx-auto max-w-6xl">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3 fade-in" style="animation-delay: 0.1s">
                    <div class="text-3xl floating">üîÆ</div>
                    <h1 class="text-2xl md:text-3xl font-bold shimmer">Prism</h1>
                </div>
                <div class="flex items-center space-x-4 fade-in" style="animation-delay: 0.3s">
                    <div class="text-sm opacity-90 fade-in" style="animation-delay: 0.5s">Tu bienestar emocional importa</div>
                    <button id="profileBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all glow-effect">
                        üë§ Perfil
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="container mx-auto max-w-6xl px-4">
            <div class="flex space-x-8 overflow-x-auto py-4">
                <button class="nav-btn whitespace-nowrap px-4 py-2 rounded-lg font-medium transition-all fade-in" style="animation-delay: 0.1s" data-section="dashboard">üè† Dashboard</button>
                <button class="nav-btn whitespace-nowrap px-4 py-2 rounded-lg font-medium transition-all fade-in" style="animation-delay: 0.2s" data-section="ambivalencia">üó∫Ô∏è Mapa de Ambivalencia</button>
                <button class="nav-btn whitespace-nowrap px-4 py-2 rounded-lg font-medium transition-all fade-in" style="animation-delay: 0.3s" data-section="balanza">‚öñÔ∏è Balanza Emp√°tica</button>
                <button class="nav-btn whitespace-nowrap px-4 py-2 rounded-lg font-medium transition-all fade-in" style="animation-delay: 0.4s" data-section="recarga">üîã Protocolos de Recarga</button>
                <button class="nav-btn whitespace-nowrap px-4 py-2 rounded-lg font-medium transition-all fade-in" style="animation-delay: 0.5s" data-section="perspectiva">üí° Lente de Perspectiva</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto max-w-6xl px-4 py-8">
        
        <!-- Dashboard Section -->
        <section id="dashboard" class="section-content">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">Bienvenido a tu espacio de equilibrio</h2>
                <p class="text-gray-600">Aqu√≠ puedes ver tu progreso y acceder a todas las herramientas de bienestar emocional.</p>
            </div>

            <!-- Progress Overview -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl p-6 shadow-sm border card-hover fade-in glow-effect" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-2xl floating">üó∫Ô∏è</div>
                        <span class="text-sm text-gray-500">Esta semana</span>
                    </div>
                    <h3 class="font-semibold text-gray-800">Mapas Completados</h3>
                    <p class="text-2xl font-bold text-blue-600 pulse-gentle">3</p>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-sm border card-hover fade-in glow-effect" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-2xl floating" style="animation-delay: 0.5s">‚öñÔ∏è</div>
                        <span class="text-sm text-gray-500">Balance actual</span>
                    </div>
                    <h3 class="font-semibold text-gray-800">Equilibrio Emp√°tico</h3>
                    <p class="text-2xl font-bold text-green-600 pulse-gentle" style="animation-delay: 0.3s">72%</p>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-sm border card-hover fade-in glow-effect" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-2xl floating" style="animation-delay: 1s">üîã</div>
                        <span class="text-sm text-gray-500">Nivel de energ√≠a</span>
                    </div>
                    <h3 class="font-semibold text-gray-800">Energ√≠a Emocional</h3>
                    <p class="text-2xl font-bold text-yellow-600 pulse-gentle" style="animation-delay: 0.6s">65%</p>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-sm border card-hover fade-in glow-effect" style="animation-delay: 0.4s">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-2xl floating" style="animation-delay: 1.5s">üí°</div>
                        <span class="text-sm text-gray-500">Insights</span>
                    </div>
                    <h3 class="font-semibold text-gray-800">Perspectivas Nuevas</h3>
                    <p class="text-2xl font-bold text-purple-600 pulse-gentle" style="animation-delay: 0.9s">5</p>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="bg-white rounded-xl p-6 shadow-sm border mb-8 fade-in glow-effect" style="animation-delay: 0.5s">
                <h3 class="text-xl font-semibold mb-4">Acciones R√°pidas</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <button class="quick-action-btn p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all fade-in" style="animation-delay: 0.6s" data-action="check-in">
                        <div class="text-2xl mb-2 floating">üìù</div>
                        <div class="font-medium">Check-in Emocional</div>
                    </button>
                    <button class="quick-action-btn p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-green-400 hover:bg-green-50 transition-all fade-in" style="animation-delay: 0.7s" data-action="breathing">
                        <div class="text-2xl mb-2 floating" style="animation-delay: 0.5s">ü´Å</div>
                        <div class="font-medium">Respiraci√≥n Guiada</div>
                    </button>
                    <button class="quick-action-btn p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-purple-400 hover:bg-purple-50 transition-all fade-in" style="animation-delay: 0.8s" data-action="reflection">
                        <div class="text-2xl mb-2 floating" style="animation-delay: 1s">ü§î</div>
                        <div class="font-medium">Reflexi√≥n R√°pida</div>
                    </button>
                    <button class="quick-action-btn p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-yellow-400 hover:bg-yellow-50 transition-all fade-in" style="animation-delay: 0.9s" data-action="gratitude">
                        <div class="text-2xl mb-2 floating" style="animation-delay: 1.5s">üôè</div>
                        <div class="font-medium">Momento de Gratitud</div>
                    </button>
                </div>
            </div>
        </section>

        <!-- Mapa de Ambivalencia Section -->
        <section id="ambivalencia" class="section-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">üó∫Ô∏è Mapa de Ambivalencia</h2>
                <p class="text-gray-600">Explora y comprende tus sentimientos contradictorios para encontrar claridad.</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="text-xl font-semibold mb-4">Identifica tu Conflicto</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">¬øQu√© situaci√≥n te genera sentimientos contradictorios?</label>
                            <textarea id="conflictSituation" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3" placeholder="Describe la situaci√≥n que te causa ambivalencia..."></textarea>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Sentimiento Positivo</label>
                                <input type="text" id="positiveFeeling" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="ej. Amor, esperanza...">
                                <div class="mt-2">
                                    <label class="block text-xs text-gray-500 mb-1">Intensidad (1-10)</label>
                                    <input type="range" id="positiveIntensity" min="1" max="10" value="5" class="w-full">
                                    <span id="positiveValue" class="text-sm text-green-600 font-medium">5</span>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Sentimiento Negativo</label>
                                <input type="text" id="negativeFeeling" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500" placeholder="ej. Frustraci√≥n, miedo...">
                                <div class="mt-2">
                                    <label class="block text-xs text-gray-500 mb-1">Intensidad (1-10)</label>
                                    <input type="range" id="negativeIntensity" min="1" max="10" value="5" class="w-full">
                                    <span id="negativeValue" class="text-sm text-red-600 font-medium">5</span>
                                </div>
                            </div>
                        </div>
                        
                        <button id="generateMap" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            Generar Mapa de Ambivalencia
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="text-xl font-semibold mb-4">Tu Mapa Visual</h3>
                    <div id="ambivalenceMap" class="h-64 flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg">
                        <p class="text-gray-500">Completa el formulario para ver tu mapa</p>
                    </div>
                    
                    <div id="mapInsights" class="mt-6 hidden">
                        <h4 class="font-semibold text-gray-800 mb-2">Insights de tu Mapa</h4>
                        <div id="insightContent" class="text-sm text-gray-600 bg-blue-50 p-4 rounded-lg"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Balanza Emp√°tica Section -->
        <section id="balanza" class="section-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">‚öñÔ∏è Balanza Emp√°tica</h2>
                <p class="text-gray-600">Visualiza el equilibrio entre dar y recibir energ√≠a emocional.</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="text-xl font-semibold mb-4">Registra tu Energ√≠a</h3>
                    <div class="space-y-6">
                        <div>
                            <h4 class="font-medium text-gray-800 mb-3">Energ√≠a que Das (esta semana)</h4>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm">Escuchar problemas de otros</span>
                                    <input type="range" id="listening" min="0" max="10" value="7" class="w-24">
                                    <span id="listeningValue" class="text-sm font-medium w-8">7</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm">Dar consejos y apoyo</span>
                                    <input type="range" id="advising" min="0" max="10" value="6" class="w-24">
                                    <span id="advisingValue" class="text-sm font-medium w-8">6</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm">Cuidar de otros</span>
                                    <input type="range" id="caring" min="0" max="10" value="8" class="w-24">
                                    <span id="caringValue" class="text-sm font-medium w-8">8</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm">Resolver conflictos</span>
                                    <input type="range" id="resolving" min="0" max="10" value="5" class="w-24">
                                    <span id="resolvingValue" class="text-sm font-medium w-8">5</span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-medium text-gray-800 mb-3">Energ√≠a que Recibes (esta semana)</h4>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm">Apoyo emocional recibido</span>
                                    <input type="range" id="receivingSupport" min="0" max="10" value="4" class="w-24">
                                    <span id="receivingSupportValue" class="text-sm font-medium w-8">4</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm">Tiempo para ti mismo</span>
                                    <input type="range" id="selfTime" min="0" max="10" value="3" class="w-24">
                                    <span id="selfTimeValue" class="text-sm font-medium w-8">3</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm">Actividades que disfrutas</span>
                                    <input type="range" id="enjoyableActivities" min="0" max="10" value="5" class="w-24">
                                    <span id="enjoyableActivitiesValue" class="text-sm font-medium w-8">5</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm">Reconocimiento y gratitud</span>
                                    <input type="range" id="recognition" min="0" max="10" value="2" class="w-24">
                                    <span id="recognitionValue" class="text-sm font-medium w-8">2</span>
                                </div>
                            </div>
                        </div>
                        
                        <button id="updateBalance" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            Actualizar Balanza
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="text-xl font-semibold mb-4">Tu Balanza Emp√°tica</h3>
                    <div class="h-64 mb-4">
                        <canvas id="empathyChart"></canvas>
                    </div>
                    
                    <div id="balanceAnalysis" class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <span class="text-sm font-medium">Energ√≠a Total Dada:</span>
                            <span id="totalGiven" class="font-bold text-red-600">26</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <span class="text-sm font-medium">Energ√≠a Total Recibida:</span>
                            <span id="totalReceived" class="font-bold text-green-600">14</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                            <span class="text-sm font-medium">Balance:</span>
                            <span id="balanceResult" class="font-bold text-blue-600">-12 (D√©ficit)</span>
                        </div>
                    </div>
                    
                    <div id="balanceRecommendation" class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <h4 class="font-semibold text-yellow-800 mb-2">üí° Recomendaci√≥n</h4>
                        <p class="text-sm text-yellow-700">Tienes un d√©ficit emp√°tico significativo. Es importante que dediques m√°s tiempo al autocuidado y busques apoyo.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Protocolos de Recarga Section -->
        <section id="recarga" class="section-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">üîã Protocolos de Recarga</h2>
                <p class="text-gray-600">Estrategias personalizadas para restaurar tu energ√≠a emocional.</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Protocolo Inmediato -->
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center mb-4">
                        <div class="text-2xl mr-3">‚ö°</div>
                        <h3 class="text-xl font-semibold">Recarga Inmediata</h3>
                    </div>
                    <p class="text-gray-600 mb-4">Para cuando necesitas energ√≠a ahora mismo</p>
                    
                    <div class="space-y-3">
                        <button class="protocol-btn w-full text-left p-3 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-all" data-protocol="breathing">
                            <div class="font-medium">ü´Å Respiraci√≥n 4-7-8</div>
                            <div class="text-sm text-gray-500">5 minutos</div>
                        </button>
                        
                        <button class="protocol-btn w-full text-left p-3 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-all" data-protocol="movement">
                            <div class="font-medium">üö∂ Caminata consciente</div>
                            <div class="text-sm text-gray-500">10 minutos</div>
                        </button>
                        
                        <button class="protocol-btn w-full text-left p-3 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-all" data-protocol="music">
                            <div class="font-medium">üéµ M√∫sica relajante</div>
                            <div class="text-sm text-gray-500">15 minutos</div>
                        </button>
                    </div>
                </div>

                <!-- Protocolo Diario -->
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center mb-4">
                        <div class="text-2xl mr-3">üåÖ</div>
                        <h3 class="text-xl font-semibold">Recarga Diaria</h3>
                    </div>
                    <p class="text-gray-600 mb-4">Rutinas para mantener tu energ√≠a estable</p>
                    
                    <div class="space-y-3">
                        <div class="p-3 border border-gray-200 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium">üìù Journaling matutino</span>
                                <input type="checkbox" class="daily-habit" data-habit="journaling">
                            </div>
                            <div class="text-sm text-gray-500">15 minutos cada ma√±ana</div>
                        </div>
                        
                        <div class="p-3 border border-gray-200 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium">üö´ L√≠mites digitales</span>
                                <input type="checkbox" class="daily-habit" data-habit="digital-limits">
                            </div>
                            <div class="text-sm text-gray-500">Sin pantallas 1h antes de dormir</div>
                        </div>
                        
                        <div class="p-3 border border-gray-200 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium">üõÅ Ritual de autocuidado</span>
                                <input type="checkbox" class="daily-habit" data-habit="self-care">
                            </div>
                            <div class="text-sm text-gray-500">30 minutos para ti</div>
                        </div>
                    </div>
                </div>

                <!-- Protocolo Semanal -->
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center mb-4">
                        <div class="text-2xl mr-3">üìÖ</div>
                        <h3 class="text-xl font-semibold">Recarga Semanal</h3>
                    </div>
                    <p class="text-gray-600 mb-4">Actividades para una recarga profunda</p>
                    
                    <div class="space-y-3">
                        <div class="p-3 border border-gray-200 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium">üå≥ Tiempo en naturaleza</span>
                                <input type="checkbox" class="weekly-habit" data-habit="nature">
                            </div>
                            <div class="text-sm text-gray-500">M√≠nimo 2 horas</div>
                        </div>
                        
                        <div class="p-3 border border-gray-200 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium">üë• Conexi√≥n social positiva</span>
                                <input type="checkbox" class="weekly-habit" data-habit="social">
                            </div>
                            <div class="text-sm text-gray-500">Tiempo con personas que te nutren</div>
                        </div>
                        
                        <div class="p-3 border border-gray-200 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium">üé® Actividad creativa</span>
                                <input type="checkbox" class="weekly-habit" data-habit="creative">
                            </div>
                            <div class="text-sm text-gray-500">Expresi√≥n personal libre</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Protocolo Activo -->
            <div id="activeProtocol" class="mt-8 bg-gradient-to-r from-blue-50 to-green-50 rounded-xl p-6 border hidden">
                <h3 class="text-xl font-semibold mb-4">Protocolo en Progreso</h3>
                <div id="protocolContent"></div>
            </div>
        </section>

        <!-- Lente de Perspectiva Section -->
        <section id="perspectiva" class="section-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">üí° Lente de Perspectiva</h2>
                <p class="text-gray-600">Transforma pensamientos negativos en perspectivas m√°s equilibradas y compasivas.</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="text-xl font-semibold mb-4">Reestructura tu Pensamiento</h3>
                    
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pensamiento Autom√°tico</label>
                            <textarea id="automaticThought" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" rows="3" placeholder="¬øQu√© pensamiento negativo est√° pasando por tu mente?"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Intensidad Emocional (1-10)</label>
                            <input type="range" id="emotionalIntensity" min="1" max="10" value="7" class="w-full">
                            <div class="flex justify-between text-sm text-gray-500 mt-1">
                                <span>Leve</span>
                                <span id="intensityValue" class="font-medium">7</span>
                                <span>Intensa</span>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Categor√≠a del Pensamiento</label>
                            <select id="thoughtCategory" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="">Selecciona una categor√≠a</option>
                                <option value="catastrophizing">Catastrofizaci√≥n</option>
                                <option value="all-or-nothing">Pensamiento todo o nada</option>
                                <option value="mind-reading">Lectura de mente</option>
                                <option value="fortune-telling">Adivinaci√≥n del futuro</option>
                                <option value="personalization">Personalizaci√≥n</option>
                                <option value="should-statements">Declaraciones "deber√≠a"</option>
                                <option value="emotional-reasoning">Razonamiento emocional</option>
                            </select>
                        </div>
                        
                        <button id="reframeThought" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            Generar Nueva Perspectiva
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <h3 class="text-xl font-semibold mb-4">Tu Nueva Perspectiva</h3>
                    
                    <div id="reframedContent" class="hidden">
                        <div class="space-y-4">
                            <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                                <h4 class="font-semibold text-red-800 mb-2">Pensamiento Original:</h4>
                                <p id="originalThoughtDisplay" class="text-red-700"></p>
                            </div>
                            
                            <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                                <h4 class="font-semibold text-green-800 mb-2">Perspectiva Reencuadrada:</h4>
                                <p id="reframedThoughtDisplay" class="text-green-700"></p>
                            </div>
                            
                            <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                <h4 class="font-semibold text-blue-800 mb-2">Preguntas de Reflexi√≥n:</h4>
                                <ul id="reflectionQuestions" class="text-blue-700 space-y-1"></ul>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nueva Intensidad Emocional</label>
                                <input type="range" id="newIntensity" min="1" max="10" value="4" class="w-full">
                                <div class="flex justify-between text-sm text-gray-500 mt-1">
                                    <span>Leve</span>
                                    <span id="newIntensityValue" class="font-medium">4</span>
                                    <span>Intensa</span>
                                </div>
                            </div>
                            
                            <button id="saveReframe" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                                Guardar en mi Diario de Perspectivas
                            </button>
                        </div>
                    </div>
                    
                    <div id="perspectivePlaceholder" class="h-64 flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg">
                        <p class="text-gray-500 text-center">Completa el ejercicio para ver tu nueva perspectiva</p>
                    </div>
                </div>
            </div>

            <!-- Historial de Perspectivas -->
            <div class="mt-8 bg-white rounded-xl p-6 shadow-sm border">
                <h3 class="text-xl font-semibold mb-4">Tu Diario de Perspectivas</h3>
                <div id="perspectiveHistory" class="space-y-4">
                    <p class="text-gray-500 text-center py-8">A√∫n no tienes perspectivas guardadas. ¬°Comienza tu primer ejercicio!</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-16">
        <div class="container mx-auto max-w-6xl px-4 text-center">
            <div class="flex items-center justify-center space-x-3 mb-4">
                <div class="text-2xl">‚öñÔ∏è</div>
                <h3 class="text-xl font-bold">Equilibrio</h3>
            </div>
            <p class="text-gray-400 mb-4">Tu compa√±ero de bienestar emocional</p>
            <p class="text-sm text-gray-500">Recuerda: buscar ayuda profesional es siempre una opci√≥n v√°lida y recomendada.</p>
        </div>
    </footer>

    <script>
        // Navigation functionality
        document.addEventListener('DOMContentLoaded', function() {
            const navButtons = document.querySelectorAll('.nav-btn');
            const sections = document.querySelectorAll('.section-content');
            
            // Set dashboard as active by default
            navButtons[0].classList.add('tool-active');
            
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetSection = button.getAttribute('data-section');
                    
                    // Update active nav button
                    navButtons.forEach(btn => btn.classList.remove('tool-active'));
                    button.classList.add('tool-active');
                    
                    // Show target section
                    sections.forEach(section => {
                        if (section.id === targetSection) {
                            section.classList.remove('hidden');
                        } else {
                            section.classList.add('hidden');
                        }
                    });
                    
                    // Scroll to top when changing sections
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            });
            
            // Initialize all functionality
            initializeAmbivalenceMap();
            initializeEmpathyBalance();
            initializeRechargeProtocols();
            initializePerspectiveLens();
            initializeQuickActions();
            initializeProfileButton();
            updateDashboardStats();
        });
        
        // Ambivalence Map functionality
        function initializeAmbivalenceMap() {
            const positiveIntensity = document.getElementById('positiveIntensity');
            const negativeIntensity = document.getElementById('negativeIntensity');
            const positiveValue = document.getElementById('positiveValue');
            const negativeValue = document.getElementById('negativeValue');
            const generateMapBtn = document.getElementById('generateMap');
            
            positiveIntensity.addEventListener('input', () => {
                positiveValue.textContent = positiveIntensity.value;
            });
            
            negativeIntensity.addEventListener('input', () => {
                negativeValue.textContent = negativeIntensity.value;
            });
            
            generateMapBtn.addEventListener('click', () => {
                generateAmbivalenceMap();
            });
        }
        
        function generateAmbivalenceMap() {
            const situation = document.getElementById('conflictSituation').value;
            const positiveFeeling = document.getElementById('positiveFeeling').value;
            const negativeFeeling = document.getElementById('negativeFeeling').value;
            const positiveIntensity = document.getElementById('positiveIntensity').value;
            const negativeIntensity = document.getElementById('negativeIntensity').value;
            
            if (!situation || !positiveFeeling || !negativeFeeling) {
                showNotification('Por favor completa todos los campos üìù', 'warning');
                return;
            }
            
            const mapContainer = document.getElementById('ambivalenceMap');
            const insightsContainer = document.getElementById('mapInsights');
            const insightContent = document.getElementById('insightContent');
            
            // Create visual map
            mapContainer.innerHTML = `
                <div class="w-full h-full flex flex-col justify-center items-center relative">
                    <div class="absolute top-4 left-4 right-4 text-center">
                        <h4 class="font-semibold text-gray-800">${situation}</h4>
                    </div>
                    <div class="flex items-center justify-between w-full px-8">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center text-white font-bold text-lg mb-2" style="opacity: ${positiveIntensity/10}">
                                ${positiveIntensity}
                            </div>
                            <p class="text-sm font-medium text-green-700">${positiveFeeling}</p>
                        </div>
                        <div class="text-4xl text-gray-400">‚öñÔ∏è</div>
                        <div class="text-center">
                            <div class="w-16 h-16 bg-red-500 rounded-full flex items-center justify-center text-white font-bold text-lg mb-2" style="opacity: ${negativeIntensity/10}">
                                ${negativeIntensity}
                            </div>
                            <p class="text-sm font-medium text-red-700">${negativeFeeling}</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Generate insights
            const balance = positiveIntensity - negativeIntensity;
            let insight = '';
            
            if (Math.abs(balance) <= 2) {
                insight = `Tienes un equilibrio relativo entre ${positiveFeeling} y ${negativeFeeling}. Esta ambivalencia es normal y puede ser una se√±al de que est√°s procesando una situaci√≥n compleja. Considera que ambos sentimientos pueden coexistir y ser v√°lidos.`;
            } else if (balance > 2) {
                insight = `Tu ${positiveFeeling} es m√°s fuerte que tu ${negativeFeeling}. Esto sugiere que, aunque hay aspectos desafiantes, hay elementos positivos significativos en esta situaci√≥n. Enf√≥cate en nutrir estos aspectos positivos mientras abordas las preocupaciones.`;
            } else {
                insight = `Tu ${negativeFeeling} est√° dominando sobre tu ${positiveFeeling}. Es importante reconocer estos sentimientos dif√≠ciles. Considera buscar apoyo y recordar que los sentimientos negativos intensos son temporales.`;
            }
            
            insightContent.textContent = insight;
            insightsContainer.classList.remove('hidden');
        }
        
        // Empathy Balance functionality
        function initializeEmpathyBalance() {
            const sliders = ['listening', 'advising', 'caring', 'resolving', 'receivingSupport', 'selfTime', 'enjoyableActivities', 'recognition'];
            
            sliders.forEach(slider => {
                const element = document.getElementById(slider);
                const valueElement = document.getElementById(slider + 'Value');
                
                element.addEventListener('input', () => {
                    valueElement.textContent = element.value;
                    updateEmpathyBalance();
                });
            });
            
            document.getElementById('updateBalance').addEventListener('click', updateEmpathyBalance);
            
            // Initialize chart
            updateEmpathyBalance();
        }
        
        function updateEmpathyBalance() {
            const given = parseInt(document.getElementById('listening').value) + 
                         parseInt(document.getElementById('advising').value) + 
                         parseInt(document.getElementById('caring').value) + 
                         parseInt(document.getElementById('resolving').value);
            
            const received = parseInt(document.getElementById('receivingSupport').value) + 
                            parseInt(document.getElementById('selfTime').value) + 
                            parseInt(document.getElementById('enjoyableActivities').value) + 
                            parseInt(document.getElementById('recognition').value);
            
            const balance = received - given;
            
            document.getElementById('totalGiven').textContent = given;
            document.getElementById('totalReceived').textContent = received;
            
            let balanceText = '';
            let recommendation = '';
            
            if (balance > 5) {
                balanceText = `+${balance} (Super√°vit)`;
                recommendation = 'Tienes un buen equilibrio emp√°tico. Considera compartir tu energ√≠a positiva con otros de manera consciente.';
            } else if (balance >= -5) {
                balanceText = `${balance} (Equilibrado)`;
                recommendation = 'Tienes un equilibrio emp√°tico saludable. Mant√©n este balance siendo consciente de tus necesidades.';
            } else {
                balanceText = `${balance} (D√©ficit)`;
                recommendation = 'Tienes un d√©ficit emp√°tico significativo. Es importante que dediques m√°s tiempo al autocuidado y busques apoyo.';
            }
            
            document.getElementById('balanceResult').textContent = balanceText;
            document.getElementById('balanceRecommendation').innerHTML = `
                <h4 class="font-semibold text-yellow-800 mb-2">üí° Recomendaci√≥n</h4>
                <p class="text-sm text-yellow-700">${recommendation}</p>
            `;
            
            // Update chart
            const ctx = document.getElementById('empathyChart').getContext('2d');
            
            if (window.empathyChart && typeof window.empathyChart.destroy === 'function') {
                window.empathyChart.destroy();
            }
            
            if (typeof Chart !== 'undefined') {
                window.empathyChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Energ√≠a Dada', 'Energ√≠a Recibida'],
                    datasets: [{
                        data: [given, received],
                        backgroundColor: ['#FF6B6B', '#06D6A0'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    cutout: '60%'
                }
            });
            } else {
                console.error('Chart.js no est√° cargado');
            }
        }
        
        // Recharge Protocols functionality
        function initializeRechargeProtocols() {
            const protocolBtns = document.querySelectorAll('.protocol-btn');
            const dailyHabits = document.querySelectorAll('.daily-habit');
            const weeklyHabits = document.querySelectorAll('.weekly-habit');
            
            protocolBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const protocol = btn.getAttribute('data-protocol');
                    startProtocol(protocol);
                });
            });
            
            // Load saved habits
            loadHabits();
            
            dailyHabits.forEach(checkbox => {
                checkbox.addEventListener('change', saveHabits);
            });
            
            weeklyHabits.forEach(checkbox => {
                checkbox.addEventListener('change', saveHabits);
            });
        }
        
        function startProtocol(protocolType) {
            const activeProtocol = document.getElementById('activeProtocol');
            const protocolContent = document.getElementById('protocolContent');
            
            let content = '';
            
            switch(protocolType) {
                case 'breathing':
                    content = `
                        <div class="text-center">
                            <h4 class="text-lg font-semibold mb-4">ü´Å Respiraci√≥n 4-7-8</h4>
                            
                            <div class="breathing-circle-container mb-6">
                                <div class="breathing-circle" id="breathingCircle">
                                    <div class="circle-inner"></div>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <p class="text-gray-600">Inhala por 4 segundos, mant√©n por 7, exhala por 8</p>
                                <div class="mb-4">
                                    <div class="text-3xl font-bold text-blue-600 mb-2" id="breathingPhase">Prep√°rate</div>
                                    <div class="text-lg text-gray-600" id="breathingInstruction">Haz clic en "Comenzar" cuando est√©s listo</div>
                                    <div class="text-4xl font-bold text-gray-800 mt-2" id="breathingTimer"></div>
                                </div>
                                <div class="flex gap-4 justify-center">
                                    <button id="startBreathing" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">Comenzar</button>
                                    <button id="stopBreathing" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors" style="display: none;">Detener</button>
                                    <button id="closeProtocol" class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-colors">Cerrar</button>
                                </div>
                            </div>
                        </div>
                        
                        <style>
                            .breathing-circle-container {
                                display: flex;
                                justify-content: center;
                                align-items: center;
                            }
                            
                            .breathing-circle {
                                width: 150px;
                                height: 150px;
                                border: 3px solid #3B82F6;
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                position: relative;
                                background: rgba(59, 130, 246, 0.1);
                            }
                            
                            .circle-inner {
                                width: 80px;
                                height: 80px;
                                background: linear-gradient(45deg, #3B82F6, #60A5FA);
                                border-radius: 50%;
                                transition: transform 0.3s ease;
                                box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
                            }
                            
                            .breathing-inhale .circle-inner {
                                transform: scale(1.5);
                                background: linear-gradient(45deg, #10B981, #34D399);
                            }
                            
                            .breathing-hold .circle-inner {
                                transform: scale(1.5);
                                background: linear-gradient(45deg, #F59E0B, #FBBF24);
                            }
                            
                            .breathing-exhale .circle-inner {
                                transform: scale(0.8);
                                background: linear-gradient(45deg, #8B5CF6, #A78BFA);
                            }
                        </style>
                    `;
                    break;
                case 'movement':
                    content = `
                        <div class="text-center">
                            <h4 class="text-lg font-semibold mb-4">üö∂ Caminata Consciente</h4>
                            
                            <div class="walking-animation mb-6">
                                <div class="walking-figure" id="walkingFigure">üö∂‚Äç‚ôÄÔ∏è</div>
                            </div>
                            
                            <div class="space-y-4">
                                <p class="text-gray-600">Camina lentamente, prestando atenci√≥n a cada paso y tu respiraci√≥n</p>
                                <div class="mb-4">
                                    <div class="text-3xl font-bold text-green-600 mb-2" id="walkPhase">Prep√°rate</div>
                                    <div class="text-lg text-gray-600" id="walkInstruction">Encuentra un lugar c√≥modo para caminar</div>
                                    <div class="text-4xl font-bold text-gray-800 mt-2" id="walkTimer">10:00</div>
                                </div>
                                <div class="flex gap-4 justify-center">
                                    <button id="startWalk" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">Comenzar</button>
                                    <button id="pauseWalk" class="bg-yellow-500 text-white px-6 py-2 rounded-lg hover:bg-yellow-600 transition-colors" style="display: none;">Pausar</button>
                                    <button id="stopWalk" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors" style="display: none;">Detener</button>
                                    <button id="closeWalk" class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-colors">Cerrar</button>
                                </div>
                            </div>
                        </div>
                        
                        <style>
                            .walking-animation {
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                height: 100px;
                                background: linear-gradient(135deg, #D1FAE5, #A7F3D0);
                                border-radius: 15px;
                                position: relative;
                                overflow: hidden;
                            }
                            
                            .walking-figure {
                                font-size: 3rem;
                                animation: walk 2s ease-in-out infinite;
                                filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
                            }
                            
                            .walking-active .walking-figure {
                                animation: walk 1s ease-in-out infinite;
                            }
                            
                            @keyframes walk {
                                0%, 100% { transform: translateY(0px) scale(1); }
                                25% { transform: translateY(-5px) scale(1.05); }
                                50% { transform: translateY(0px) scale(1); }
                                75% { transform: translateY(-3px) scale(1.02); }
                            }
                        </style>
                    `;
                    break;
                case 'music':
                    content = `
                        <div class="text-center">
                            <h4 class="text-lg font-semibold mb-4">üéµ M√∫sica Relajante</h4>
                            
                            <div class="music-visualizer mb-6">
                                <div class="music-bars" id="musicBars">
                                    <div class="bar"></div>
                                    <div class="bar"></div>
                                    <div class="bar"></div>
                                    <div class="bar"></div>
                                    <div class="bar"></div>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <p class="text-gray-600">Escucha m√∫sica que te calme y te haga sentir en paz</p>
                                
                                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                    <h5 class="font-semibold mb-3">Sugerencias de m√∫sica relajante:</h5>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                                        <div class="music-suggestion" data-type="nature">üåä Sonidos del oc√©ano</div>
                                        <div class="music-suggestion" data-type="rain">üåßÔ∏è Lluvia suave</div>
                                        <div class="music-suggestion" data-type="forest">üå≤ Bosque tranquilo</div>
                                        <div class="music-suggestion" data-type="piano">üéπ Piano instrumental</div>
                                        <div class="music-suggestion" data-type="meditation">üßò M√∫sica de meditaci√≥n</div>
                                        <div class="music-suggestion" data-type="ambient">üåå Ambient espacial</div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="text-3xl font-bold text-purple-600 mb-2" id="musicPhase">Selecciona tu m√∫sica</div>
                                    <div class="text-lg text-gray-600" id="musicInstruction">Elige una opci√≥n o reproduce tu m√∫sica favorita</div>
                                    <div class="text-2xl font-bold text-gray-800 mt-2" id="musicTimer">15:00</div>
                                </div>
                                
                                <div class="flex gap-4 justify-center">
                                    <button id="startMusic" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors">Comenzar Sesi√≥n</button>
                                    <button id="pauseMusic" class="bg-yellow-500 text-white px-6 py-2 rounded-lg hover:bg-yellow-600 transition-colors" style="display: none;">Pausar</button>
                                    <button id="stopMusic" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors" style="display: none;">Detener</button>
                                    <button id="closeMusic" class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-colors">Cerrar</button>
                                </div>
                            </div>
                        </div>
                        
                        <style>
                            .music-visualizer {
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                height: 100px;
                                background: linear-gradient(135deg, #F3E8FF, #E9D5FF);
                                border-radius: 15px;
                                padding: 20px;
                            }
                            
                            .music-bars {
                                display: flex;
                                align-items: end;
                                gap: 4px;
                                height: 60px;
                            }
                            
                            .bar {
                                width: 8px;
                                background: linear-gradient(to top, #8B5CF6, #A78BFA);
                                border-radius: 4px;
                                animation: musicPulse 1.5s ease-in-out infinite;
                            }
                            
                            .bar:nth-child(1) { height: 20px; animation-delay: 0s; }
                            .bar:nth-child(2) { height: 40px; animation-delay: 0.2s; }
                            .bar:nth-child(3) { height: 60px; animation-delay: 0.4s; }
                            .bar:nth-child(4) { height: 35px; animation-delay: 0.6s; }
                            .bar:nth-child(5) { height: 25px; animation-delay: 0.8s; }
                            
                            .music-active .bar {
                                animation: musicPulse 0.8s ease-in-out infinite;
                            }
                            
                            @keyframes musicPulse {
                                0%, 100% { transform: scaleY(0.5); opacity: 0.7; }
                                50% { transform: scaleY(1); opacity: 1; }
                            }
                            
                            .music-suggestion {
                                padding: 8px 12px;
                                background: white;
                                border: 1px solid #E5E7EB;
                                border-radius: 8px;
                                cursor: pointer;
                                transition: all 0.2s;
                            }
                            
                            .music-suggestion:hover {
                                background: #F3E8FF;
                                border-color: #8B5CF6;
                                transform: translateY(-1px);
                            }
                            
                            .music-suggestion.selected {
                                background: #8B5CF6;
                                color: white;
                                border-color: #8B5CF6;
                            }
                        </style>
                    `;
                    break;
            }
            
            protocolContent.innerHTML = content;
            activeProtocol.classList.remove('hidden');
            
            // Add specific functionality for each protocol
            if (protocolType === 'breathing') {
                initializeBreathingExercise();
            } else if (protocolType === 'movement') {
                initializeWalkTimer();
            } else if (protocolType === 'music') {
                initializeMusicSession();
            }
        }
        
        function initializeBreathingExercise() {
            const startBtn = document.getElementById('startBreathing');
            const stopBtn = document.getElementById('stopBreathing');
            const closeBtn = document.getElementById('closeProtocol');
            const timer = document.getElementById('breathingTimer');
            const phase = document.getElementById('breathingPhase');
            const instruction = document.getElementById('breathingInstruction');
            const circle = document.getElementById('breathingCircle');
            
            let isBreathing = false;
            let breathingInterval;
            
            function startBreathingExercise() {
                isBreathing = true;
                let cycle = 0;
                const maxCycles = 4;
                
                startBtn.style.display = 'none';
                stopBtn.style.display = 'inline-block';
                
                function runCycle() {
                    if (!isBreathing || cycle >= maxCycles) {
                        if (cycle >= maxCycles) {
                            phase.textContent = '¬°Completado!';
                            instruction.textContent = 'Excelente trabajo. ¬øC√≥mo te sientes?';
                            timer.textContent = 'üåü';
                            circle.className = 'breathing-circle';
                            showNotification('Ejercicio de respiraci√≥n completado! üå¨Ô∏è', 'success');
                        }
                        stopBreathingExercise();
                        return;
                    }
                    
                    cycle++;
                    
                    // Fase 1: Inhalar (4 segundos)
                    phase.textContent = 'Inhala';
                    instruction.textContent = 'Respira profundamente por la nariz';
                    circle.className = 'breathing-circle breathing-inhale';
                    
                    let count = 4;
                    timer.textContent = count;
                    
                    const inhaleInterval = setInterval(() => {
                        count--;
                        timer.textContent = count;
                        if (count <= 0 || !isBreathing) {
                            clearInterval(inhaleInterval);
                            if (isBreathing) holdBreath();
                        }
                    }, 1000);
                }
                
                function holdBreath() {
                    // Fase 2: Mantener (7 segundos)
                    phase.textContent = 'Mant√©n';
                    instruction.textContent = 'Ret√©n el aire en tus pulmones';
                    circle.className = 'breathing-circle breathing-hold';
                    
                    let count = 7;
                    timer.textContent = count;
                    
                    const holdInterval = setInterval(() => {
                        count--;
                        timer.textContent = count;
                        if (count <= 0 || !isBreathing) {
                            clearInterval(holdInterval);
                            if (isBreathing) exhaleBreath();
                        }
                    }, 1000);
                }
                
                function exhaleBreath() {
                    // Fase 3: Exhalar (8 segundos)
                    phase.textContent = 'Exhala';
                    instruction.textContent = 'Suelta el aire lentamente por la boca';
                    circle.className = 'breathing-circle breathing-exhale';
                    
                    let count = 8;
                    timer.textContent = count;
                    
                    const exhaleInterval = setInterval(() => {
                        count--;
                        timer.textContent = count;
                        if (count <= 0 || !isBreathing) {
                            clearInterval(exhaleInterval);
                            if (isBreathing) {
                                setTimeout(() => {
                                    runCycle();
                                }, 1000);
                            }
                        }
                    }, 1000);
                }
                
                runCycle();
            }
            
            function stopBreathingExercise() {
                isBreathing = false;
                startBtn.style.display = 'inline-block';
                stopBtn.style.display = 'none';
                phase.textContent = 'Detenido';
                instruction.textContent = 'Haz clic en "Comenzar" para reiniciar';
                timer.textContent = '';
                circle.className = 'breathing-circle';
            }
            
            startBtn.addEventListener('click', startBreathingExercise);
            stopBtn.addEventListener('click', stopBreathingExercise);
            closeBtn.addEventListener('click', () => {
                isBreathing = false;
                document.getElementById('activeProtocol').classList.add('hidden');
            });
        }
        
        function initializeWalkTimer() {
            const startBtn = document.getElementById('startWalk');
            const pauseBtn = document.getElementById('pauseWalk');
            const stopBtn = document.getElementById('stopWalk');
            const closeBtn = document.getElementById('closeWalk');
            const timer = document.getElementById('walkTimer');
            const phase = document.getElementById('walkPhase');
            const instruction = document.getElementById('walkInstruction');
            const walkingAnimation = document.querySelector('.walking-animation');
            
            let timeLeft = 600; // 10 minutes
            let interval;
            let isPaused = false;
            let isWalking = false;
            
            const walkingTips = [
                'Siente cada paso que das',
                'Respira profundamente mientras caminas',
                'Observa tu entorno con curiosidad',
                'Mant√©n una postura relajada',
                'Conecta con el momento presente',
                'Siente el contacto de tus pies con el suelo',
                'Deja que tus pensamientos fluyan sin juzgar',
                'Disfruta de este momento para ti'
            ];
            
            function startWalkingExercise() {
                isWalking = true;
                isPaused = false;
                
                startBtn.style.display = 'none';
                pauseBtn.style.display = 'inline-block';
                stopBtn.style.display = 'inline-block';
                
                phase.textContent = 'Caminando';
                walkingAnimation.classList.add('walking-active');
                
                let tipIndex = 0;
                instruction.textContent = walkingTips[tipIndex];
                
                interval = setInterval(() => {
                    if (!isPaused) {
                        const minutes = Math.floor(timeLeft / 60);
                        const seconds = timeLeft % 60;
                        timer.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                        
                        // Change tip every 90 seconds
                        if (timeLeft % 90 === 0 && timeLeft > 0) {
                            tipIndex = (tipIndex + 1) % walkingTips.length;
                            instruction.textContent = walkingTips[tipIndex];
                        }
                        
                        timeLeft--;
                        
                        if (timeLeft < 0) {
                            clearInterval(interval);
                            phase.textContent = '¬°Completado!';
                            instruction.textContent = 'Excelente caminata. ¬øC√≥mo te sientes?';
                            timer.textContent = 'üåü';
                            walkingAnimation.classList.remove('walking-active');
                            showNotification('Caminata consciente completada! üö∂‚Äç‚ôÄÔ∏è', 'success');
                            resetWalkButtons();
                        }
                    }
                }, 1000);
            }
            
            function pauseWalkingExercise() {
                isPaused = !isPaused;
                
                if (isPaused) {
                    pauseBtn.textContent = 'Reanudar';
                    phase.textContent = 'Pausado';
                    instruction.textContent = 'T√≥mate un descanso cuando lo necesites';
                    walkingAnimation.classList.remove('walking-active');
                } else {
                    pauseBtn.textContent = 'Pausar';
                    phase.textContent = 'Caminando';
                    instruction.textContent = walkingTips[Math.floor(Math.random() * walkingTips.length)];
                    walkingAnimation.classList.add('walking-active');
                }
            }
            
            function stopWalkingExercise() {
                isWalking = false;
                isPaused = false;
                clearInterval(interval);
                
                phase.textContent = 'Detenido';
                instruction.textContent = 'Haz clic en "Comenzar" para reiniciar';
                walkingAnimation.classList.remove('walking-active');
                
                timeLeft = 600;
                timer.textContent = '10:00';
                
                resetWalkButtons();
            }
            
            function resetWalkButtons() {
                startBtn.style.display = 'inline-block';
                pauseBtn.style.display = 'none';
                stopBtn.style.display = 'none';
                pauseBtn.textContent = 'Pausar';
            }
            
            startBtn.addEventListener('click', startWalkingExercise);
            pauseBtn.addEventListener('click', pauseWalkingExercise);
            stopBtn.addEventListener('click', stopWalkingExercise);
            closeBtn.addEventListener('click', () => {
                 isWalking = false;
                 clearInterval(interval);
                 document.getElementById('activeProtocol').classList.add('hidden');
             });
         }
         
         function initializeMusicSession() {
             const startBtn = document.getElementById('startMusic');
             const pauseBtn = document.getElementById('pauseMusic');
             const stopBtn = document.getElementById('stopMusic');
             const closeBtn = document.getElementById('closeMusic');
             const timer = document.getElementById('musicTimer');
             const phase = document.getElementById('musicPhase');
             const instruction = document.getElementById('musicInstruction');
             const musicVisualizer = document.querySelector('.music-visualizer');
             const musicSuggestions = document.querySelectorAll('.music-suggestion');
             
             let timeLeft = 900; // 15 minutes
             let interval;
             let isPaused = false;
             let isPlaying = false;
             let selectedMusic = null;
             
             const musicDescriptions = {
                 nature: 'Sonidos del oc√©ano - Ondas relajantes que calman la mente',
                 rain: 'Lluvia suave - Gotas que crean un ambiente de paz',
                 forest: 'Bosque tranquilo - Naturaleza que restaura el alma',
                 piano: 'Piano instrumental - Melod√≠as que tocan el coraz√≥n',
                 meditation: 'M√∫sica de meditaci√≥n - Frecuencias que centran el ser',
                 ambient: 'Ambient espacial - Sonidos que expanden la conciencia'
             };
             
             // Handle music selection
             musicSuggestions.forEach(suggestion => {
                 suggestion.addEventListener('click', () => {
                     // Remove previous selection
                     musicSuggestions.forEach(s => s.classList.remove('selected'));
                     
                     // Select current
                     suggestion.classList.add('selected');
                     selectedMusic = suggestion.getAttribute('data-type');
                     
                     phase.textContent = 'M√∫sica seleccionada';
                     instruction.textContent = musicDescriptions[selectedMusic];
                 });
             });
             
             function startMusicSession() {
                 isPlaying = true;
                 isPaused = false;
                 
                 startBtn.style.display = 'none';
                 pauseBtn.style.display = 'inline-block';
                 stopBtn.style.display = 'inline-block';
                 
                 phase.textContent = 'Reproduciendo';
                 if (selectedMusic) {
                     instruction.textContent = musicDescriptions[selectedMusic];
                 } else {
                     instruction.textContent = 'Disfruta de tu m√∫sica relajante';
                 }
                 
                 musicVisualizer.classList.add('music-active');
                 
                 interval = setInterval(() => {
                     if (!isPaused) {
                         const minutes = Math.floor(timeLeft / 60);
                         const seconds = timeLeft % 60;
                         timer.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                         
                         timeLeft--;
                         
                         if (timeLeft < 0) {
                             clearInterval(interval);
                             phase.textContent = '¬°Sesi√≥n completada!';
                             instruction.textContent = '¬øTe sientes m√°s relajado y en paz?';
                             timer.textContent = 'üéµ';
                             musicVisualizer.classList.remove('music-active');
                             showNotification('Sesi√≥n de m√∫sica relajante completada! üéµ', 'success');
                             resetMusicButtons();
                         }
                     }
                 }, 1000);
             }
             
             function pauseMusicSession() {
                 isPaused = !isPaused;
                 
                 if (isPaused) {
                     pauseBtn.textContent = 'Reanudar';
                     phase.textContent = 'Pausado';
                     instruction.textContent = 'La m√∫sica est√° en pausa';
                     musicVisualizer.classList.remove('music-active');
                 } else {
                     pauseBtn.textContent = 'Pausar';
                     phase.textContent = 'Reproduciendo';
                     if (selectedMusic) {
                         instruction.textContent = musicDescriptions[selectedMusic];
                     } else {
                         instruction.textContent = 'Disfruta de tu m√∫sica relajante';
                     }
                     musicVisualizer.classList.add('music-active');
                 }
             }
             
             function stopMusicSession() {
                 isPlaying = false;
                 isPaused = false;
                 clearInterval(interval);
                 
                 phase.textContent = 'Detenido';
                 instruction.textContent = 'Selecciona m√∫sica y haz clic en "Comenzar Sesi√≥n"';
                 musicVisualizer.classList.remove('music-active');
                 
                 timeLeft = 900;
                 timer.textContent = '15:00';
                 
                 resetMusicButtons();
             }
             
             function resetMusicButtons() {
                 startBtn.style.display = 'inline-block';
                 pauseBtn.style.display = 'none';
                 stopBtn.style.display = 'none';
                 pauseBtn.textContent = 'Pausar';
             }
             
             startBtn.addEventListener('click', startMusicSession);
             pauseBtn.addEventListener('click', pauseMusicSession);
             stopBtn.addEventListener('click', stopMusicSession);
             closeBtn.addEventListener('click', () => {
                 isPlaying = false;
                 clearInterval(interval);
                 document.getElementById('activeProtocol').classList.add('hidden');
             });
         }
        
        function saveHabits() {
            const habits = {};
            
            document.querySelectorAll('.daily-habit, .weekly-habit').forEach(checkbox => {
                habits[checkbox.getAttribute('data-habit')] = checkbox.checked;
            });
            
            localStorage.setItem('equilibrio-habits', JSON.stringify(habits));
        }
        
        function loadHabits() {
            const saved = localStorage.getItem('equilibrio-habits');
            if (saved) {
                const habits = JSON.parse(saved);
                
                Object.keys(habits).forEach(habit => {
                    const checkbox = document.querySelector(`[data-habit="${habit}"]`);
                    if (checkbox) {
                        checkbox.checked = habits[habit];
                    }
                });
            }
        }
        
        // Perspective Lens functionality
        function initializePerspectiveLens() {
            const intensitySlider = document.getElementById('emotionalIntensity');
            const intensityValue = document.getElementById('intensityValue');
            const newIntensitySlider = document.getElementById('newIntensity');
            const newIntensityValue = document.getElementById('newIntensityValue');
            const reframeBtn = document.getElementById('reframeThought');
            const saveBtn = document.getElementById('saveReframe');
            
            intensitySlider.addEventListener('input', () => {
                intensityValue.textContent = intensitySlider.value;
            });
            
            newIntensitySlider.addEventListener('input', () => {
                newIntensityValue.textContent = newIntensitySlider.value;
            });
            
            reframeBtn.addEventListener('click', reframeThought);
            saveBtn.addEventListener('click', savePerspective);
            
            loadPerspectiveHistory();
        }
        
        function reframeThought() {
            const thought = document.getElementById('automaticThought').value;
            const category = document.getElementById('thoughtCategory').value;
            const intensity = document.getElementById('emotionalIntensity').value;
            
            if (!thought || !category) {
                showNotification('Por favor completa el pensamiento y selecciona una categor√≠a üí≠', 'warning');
                return;
            }
            
            const reframes = {
                'catastrophizing': {
                    reframe: 'Aunque esta situaci√≥n es desafiante, es poco probable que sea tan terrible como imagino. ¬øCu√°l ser√≠a una perspectiva m√°s realista?',
                    questions: [
                        '¬øCu√°l es la evidencia real de que esto ser√° catastr√≥fico?',
                        '¬øQu√© es lo peor que podr√≠a pasar realmente?',
                        '¬øC√≥mo he manejado situaciones similares antes?'
                    ]
                },
                'all-or-nothing': {
                    reframe: 'Las situaciones raramente son completamente buenas o malas. Hay matices y grados intermedios que puedo reconocer.',
                    questions: [
                        '¬øQu√© aspectos positivos puedo encontrar en esta situaci√≥n?',
                        '¬øHay alg√∫n punto intermedio entre estos extremos?',
                        '¬øC√≥mo ver√≠a esto un amigo comprensivo?'
                    ]
                },
                'mind-reading': {
                    reframe: 'No puedo saber con certeza lo que otros piensan. Es m√°s √∫til comunicarme directamente o asumir intenciones positivas.',
                    questions: [
                        '¬øQu√© evidencia real tengo de lo que esta persona piensa?',
                        '¬øHay otras explicaciones posibles para su comportamiento?',
                        '¬øC√≥mo puedo verificar mis suposiciones?'
                    ]
                },
                'fortune-telling': {
                    reframe: 'El futuro es incierto y est√° lleno de posibilidades. Puedo prepararme para diferentes escenarios sin asumir el peor.',
                    questions: [
                        '¬øQu√© evidencia tengo de que esto suceder√°?',
                        '¬øCu√°les son otros resultados posibles?',
                        '¬øQu√© puedo hacer para influir positivamente en el resultado?'
                    ]
                },
                'personalization': {
                    reframe: 'No todo lo que sucede es mi responsabilidad. Hay muchos factores que influyen en las situaciones y los comportamientos de otros.',
                    questions: [
                        '¬øQu√© otros factores podr√≠an estar influyendo en esta situaci√≥n?',
                        '¬øSoy realmente responsable de todo lo que est√° pasando?',
                        '¬øC√≥mo distribuir√≠a la responsabilidad un observador objetivo?'
                    ]
                },
                'should-statements': {
                    reframe: 'En lugar de "deber√≠a", puedo pensar en "me gustar√≠a" o "ser√≠a √∫til". Esto reduce la presi√≥n y aumenta la autocompasi√≥n.',
                    questions: [
                        '¬øDe d√≥nde viene esta regla de "deber√≠a"?',
                        '¬øEs esta expectativa realista y justa?',
                        '¬øC√≥mo puedo ser m√°s compasivo conmigo mismo?'
                    ]
                },
                'emotional-reasoning': {
                    reframe: 'Mis sentimientos son v√°lidos, pero no siempre reflejan la realidad objetiva. Puedo sentir algo y a√∫n as√≠ cuestionar si es completamente cierto.',
                    questions: [
                        '¬øQu√© evidencia objetiva apoya o contradice este sentimiento?',
                        '¬øC√≥mo me sentir√≠a sobre esto en un estado emocional diferente?',
                        '¬øQu√© le dir√≠a a un amigo que sintiera lo mismo?'
                    ]
                }
            };
            
            const selectedReframe = reframes[category];
            
            document.getElementById('originalThoughtDisplay').textContent = thought;
            document.getElementById('reframedThoughtDisplay').textContent = selectedReframe.reframe;
            
            const questionsList = document.getElementById('reflectionQuestions');
            questionsList.innerHTML = '';
            selectedReframe.questions.forEach(question => {
                const li = document.createElement('li');
                li.textContent = question;
                li.className = 'text-sm';
                questionsList.appendChild(li);
            });
            
            document.getElementById('newIntensity').value = Math.max(1, intensity - 2);
            document.getElementById('newIntensityValue').textContent = Math.max(1, intensity - 2);
            
            document.getElementById('reframedContent').classList.remove('hidden');
            document.getElementById('perspectivePlaceholder').classList.add('hidden');
        }
        
        function savePerspective() {
            const originalThought = document.getElementById('automaticThought').value;
            const reframedThought = document.getElementById('reframedThoughtDisplay').textContent;
            const originalIntensity = document.getElementById('emotionalIntensity').value;
            const newIntensity = document.getElementById('newIntensity').value;
            
            const perspective = {
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                originalThought,
                reframedThought,
                originalIntensity,
                newIntensity
            };
            
            let perspectives = JSON.parse(localStorage.getItem('equilibrio-perspectives') || '[]');
            perspectives.unshift(perspective);
            
            // Keep only last 10 perspectives
            perspectives = perspectives.slice(0, 10);
            
            localStorage.setItem('equilibrio-perspectives', JSON.stringify(perspectives));
            
            loadPerspectiveHistory();
            
            // Reset form
            document.getElementById('automaticThought').value = '';
            document.getElementById('thoughtCategory').value = '';
            document.getElementById('emotionalIntensity').value = '7';
            document.getElementById('intensityValue').textContent = '7';
            
            document.getElementById('reframedContent').classList.add('hidden');
            document.getElementById('perspectivePlaceholder').classList.remove('hidden');
            
            showNotification('Perspectiva guardada en tu diario! üìñ', 'success');
        }
        
        function loadPerspectiveHistory() {
            const perspectives = JSON.parse(localStorage.getItem('equilibrio-perspectives') || '[]');
            const historyContainer = document.getElementById('perspectiveHistory');
            
            if (perspectives.length === 0) {
                historyContainer.innerHTML = '<p class="text-gray-500 text-center py-8">A√∫n no tienes perspectivas guardadas. ¬°Comienza tu primer ejercicio!</p>';
                return;
            }
            
            historyContainer.innerHTML = perspectives.map(p => `
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-sm text-gray-500">${p.date}</span>
                        <div class="text-sm">
                            <span class="text-red-600">${p.originalIntensity}/10</span> ‚Üí 
                            <span class="text-green-600">${p.newIntensity}/10</span>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <div class="text-sm">
                            <strong>Original:</strong> ${p.originalThought.substring(0, 100)}${p.originalThought.length > 100 ? '...' : ''}
                        </div>
                        <div class="text-sm text-green-700">
                            <strong>Reencuadrado:</strong> ${p.reframedThought.substring(0, 100)}${p.reframedThought.length > 100 ? '...' : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Quick Actions functionality
        function initializeQuickActions() {
            console.log('Initializing quick actions...');
            const quickActionBtns = document.querySelectorAll('.quick-action-btn');
            console.log('Found quick action buttons:', quickActionBtns.length);
            
            quickActionBtns.forEach((btn, index) => {
                console.log(`Adding listener to button ${index}:`, btn.getAttribute('data-action'));
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    console.log('Quick action button clicked!');
                    const action = btn.getAttribute('data-action');
                    console.log('Action:', action);
                    handleQuickAction(action);
                });
            });
        }
        
        function handleQuickAction(action) {
            console.log('Handling quick action:', action);
            switch(action) {
                case 'check-in':
                    console.log('Opening check-in modal...');
                    showCheckInModal();
                    break;
                case 'breathing':
                    console.log('Starting breathing exercise...');
                    // Switch to recharge section and start breathing
                    document.querySelector('[data-section="recarga"]').click();
                    setTimeout(() => startProtocol('breathing'), 500);
                    break;
                case 'reflection':
                    console.log('Opening reflection modal...');
                    showReflectionModal();
                    break;
                case 'gratitude':
                    console.log('Opening gratitude modal...');
                    showGratitudeModal();
                    break;
                default:
                    console.log('Unknown action:', action);
            }
        }
        
        function showCheckInModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
                    <h3 class="text-xl font-semibold mb-4">Check-in Emocional</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">¬øC√≥mo te sientes ahora? (1-10)</label>
                            <input type="range" id="moodSlider" min="1" max="10" value="5" class="w-full">
                            <div class="flex justify-between text-sm text-gray-500 mt-1">
                                <span>üò¢ Mal</span>
                                <span id="moodValue" class="font-medium">5</span>
                                <span>üòä Excelente</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">¬øQu√© est√° pasando por tu mente?</label>
                            <textarea id="moodThoughts" class="w-full p-3 border rounded-lg" rows="3" placeholder="Describe brevemente c√≥mo te sientes..."></textarea>
                        </div>
                        <div class="flex space-x-3">
                            <button id="saveMood" class="flex-1 bg-blue-600 text-white py-2 rounded-lg">Guardar</button>
                            <button id="cancelMood" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg">Cancelar</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const moodSlider = modal.querySelector('#moodSlider');
            const moodValue = modal.querySelector('#moodValue');
            
            moodSlider.addEventListener('input', () => {
                moodValue.textContent = moodSlider.value;
            });
            
            modal.querySelector('#saveMood').addEventListener('click', () => {
                const mood = moodSlider.value;
                const thoughts = modal.querySelector('#moodThoughts').value;
                
                // Save to localStorage
                const checkIns = JSON.parse(localStorage.getItem('equilibrio-checkins') || '[]');
                checkIns.unshift({
                    date: new Date().toLocaleString(),
                    mood: parseInt(mood),
                    thoughts
                });
                
                // Keep only last 30 check-ins
                localStorage.setItem('equilibrio-checkins', JSON.stringify(checkIns.slice(0, 30)));
                
                document.body.removeChild(modal);
                showNotification('Check-in guardado. ¬°Gracias por cuidar tu bienestar! üíö', 'success');
            });
            
            modal.querySelector('#cancelMood').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
        }
        
        function showReflectionModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
                    <h3 class="text-xl font-semibold mb-4">Reflexi√≥n R√°pida</h3>
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm text-gray-600 mb-3">T√≥mate un momento para reflexionar:</p>
                            <p class="font-medium mb-3">"¬øQu√© es una cosa por la que puedo estar agradecido en este momento?"</p>
                            <textarea id="reflectionAnswer" class="w-full p-3 border rounded-lg" rows="3" placeholder="Escribe tu reflexi√≥n..."></textarea>
                        </div>
                        <div class="flex space-x-3">
                            <button id="saveReflection" class="flex-1 bg-purple-600 text-white py-2 rounded-lg">Guardar</button>
                            <button id="cancelReflection" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg">Cancelar</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            modal.querySelector('#saveReflection').addEventListener('click', () => {
                const reflection = modal.querySelector('#reflectionAnswer').value;
                
                if (reflection.trim()) {
                    const reflections = JSON.parse(localStorage.getItem('equilibrio-reflections') || '[]');
                    reflections.unshift({
                        date: new Date().toLocaleString(),
                        content: reflection
                    });
                    
                    localStorage.setItem('equilibrio-reflections', JSON.stringify(reflections.slice(0, 20)));
                    
                    document.body.removeChild(modal);
                    showNotification('Reflexi√≥n guardada. ¬°Excelente trabajo de introspecci√≥n! ü§î', 'success');
                } else {
                    showNotification('Por favor escribe tu reflexi√≥n antes de guardar. ‚úçÔ∏è', 'warning');
                }
            });
            
            modal.querySelector('#cancelReflection').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
        }
        
        function showGratitudeModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
                    <h3 class="text-xl font-semibold mb-4">üôè Momento de Gratitud</h3>
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm text-gray-600 mb-3">Enumera 3 cosas por las que te sientes agradecido hoy:</p>
                            <div class="space-y-2">
                                <input type="text" id="gratitude1" class="w-full p-2 border rounded-lg" placeholder="1. Algo por lo que estoy agradecido...">
                                <input type="text" id="gratitude2" class="w-full p-2 border rounded-lg" placeholder="2. Algo por lo que estoy agradecido...">
                                <input type="text" id="gratitude3" class="w-full p-2 border rounded-lg" placeholder="3. Algo por lo que estoy agradecido...">
                            </div>
                        </div>
                        <div class="flex space-x-3">
                            <button id="saveGratitude" class="flex-1 bg-yellow-600 text-white py-2 rounded-lg">Guardar</button>
                            <button id="cancelGratitude" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg">Cancelar</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            modal.querySelector('#saveGratitude').addEventListener('click', () => {
                const gratitude1 = modal.querySelector('#gratitude1').value;
                const gratitude2 = modal.querySelector('#gratitude2').value;
                const gratitude3 = modal.querySelector('#gratitude3').value;
                
                if (gratitude1.trim() || gratitude2.trim() || gratitude3.trim()) {
                    const gratitudes = JSON.parse(localStorage.getItem('equilibrio-gratitudes') || '[]');
                    gratitudes.unshift({
                        date: new Date().toLocaleString(),
                        items: [gratitude1, gratitude2, gratitude3].filter(item => item.trim())
                    });
                    
                    localStorage.setItem('equilibrio-gratitudes', JSON.stringify(gratitudes.slice(0, 20)));
                    
                    document.body.removeChild(modal);
                    showNotification('¬°Gratitud guardada! Practicar la gratitud fortalece tu bienestar emocional. üôè', 'success');
                } else {
                    showNotification('Por favor escribe al menos una cosa por la que est√©s agradecido. üíõ', 'warning');
                }
            });
            
            modal.querySelector('#cancelGratitude').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
        }
        
        // Profile functionality
        function initializeProfileButton() {
            const profileBtn = document.getElementById('profileBtn');
            
            profileBtn.addEventListener('click', () => {
                showProfileModal();
            });
        }
        
        function showProfileModal() {
            const checkIns = JSON.parse(localStorage.getItem('equilibrio-checkins') || '[]');
            const perspectives = JSON.parse(localStorage.getItem('equilibrio-perspectives') || '[]');
            const reflections = JSON.parse(localStorage.getItem('equilibrio-reflections') || '[]');
            const gratitudes = JSON.parse(localStorage.getItem('equilibrio-gratitudes') || '[]');
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                    <h3 class="text-xl font-semibold mb-4">üìä Tu Perfil de Bienestar</h3>
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="text-center p-4 bg-blue-50 rounded-lg">
                            <div class="text-2xl font-bold text-blue-600">${checkIns.length}</div>
                            <div class="text-sm text-blue-700">Check-ins realizados</div>
                        </div>
                        <div class="text-center p-4 bg-purple-50 rounded-lg">
                            <div class="text-2xl font-bold text-purple-600">${perspectives.length}</div>
                            <div class="text-sm text-purple-700">Perspectivas reencuadradas</div>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <div class="text-2xl font-bold text-green-600">${reflections.length}</div>
                            <div class="text-sm text-green-700">Reflexiones guardadas</div>
                        </div>
                        <div class="text-center p-4 bg-yellow-50 rounded-lg">
                            <div class="text-2xl font-bold text-yellow-600">${gratitudes.length}</div>
                            <div class="text-sm text-yellow-700">Momentos de gratitud</div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="font-semibold mb-2">Progreso de Bienestar</h4>
                        <div class="bg-gray-200 rounded-full h-3">
                            <div class="bg-gradient-to-r from-blue-500 to-green-500 h-3 rounded-full progress-bar" style="width: ${Math.min(100, (checkIns.length + perspectives.length + reflections.length + gratitudes.length) * 2)}%"></div>
                        </div>
                        <div class="text-sm text-gray-600 mt-1">Nivel ${Math.floor((checkIns.length + perspectives.length + reflections.length + gratitudes.length) / 10) + 1}</div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button id="exportData" class="flex-1 bg-blue-600 text-white py-2 rounded-lg text-sm">Exportar</button>
                        <button id="importData" class="flex-1 bg-green-600 text-white py-2 rounded-lg text-sm">Importar</button>
                        <button id="clearData" class="flex-1 bg-red-600 text-white py-2 rounded-lg text-sm">Limpiar</button>
                        <button id="closeProfile" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg text-sm">Cerrar</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            modal.querySelector('#exportData').addEventListener('click', () => {
                 const data = {
                     checkIns,
                     perspectives,
                     reflections,
                     gratitudes,
                     exportDate: new Date().toISOString()
                 };
                 
                 const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                 const url = URL.createObjectURL(blob);
                 const a = document.createElement('a');
                 a.href = url;
                 a.download = `equilibrio-backup-${new Date().toISOString().split('T')[0]}.json`;
                 a.click();
                 URL.revokeObjectURL(url);
                 
                 showNotification('Datos exportados exitosamente! üìÅ', 'success');
             });
             
             modal.querySelector('#importData').addEventListener('click', () => {
                 const input = document.createElement('input');
                 input.type = 'file';
                 input.accept = '.json';
                 
                 input.addEventListener('change', (e) => {
                     const file = e.target.files[0];
                     if (file) {
                         const reader = new FileReader();
                         reader.onload = (e) => {
                             try {
                                 const data = JSON.parse(e.target.result);
                                 
                                 if (data.checkIns) localStorage.setItem('equilibrio-checkins', JSON.stringify(data.checkIns));
                                 if (data.perspectives) localStorage.setItem('equilibrio-perspectives', JSON.stringify(data.perspectives));
                                 if (data.reflections) localStorage.setItem('equilibrio-reflections', JSON.stringify(data.reflections));
                                 if (data.gratitudes) localStorage.setItem('equilibrio-gratitudes', JSON.stringify(data.gratitudes));
                                 
                                 document.body.removeChild(modal);
                                 showNotification('Datos importados exitosamente! üì•', 'success');
                                 updateDashboardStats();
                             } catch (error) {
                                 showNotification('Error al importar datos. Verifica el archivo. ‚ùå', 'error');
                             }
                         };
                         reader.readAsText(file);
                     }
                 });
                 
                 input.click();
             });
            
            modal.querySelector('#clearData').addEventListener('click', () => {
                if (confirm('¬øEst√°s seguro de que quieres eliminar todos tus datos? Esta acci√≥n no se puede deshacer.')) {
                    localStorage.removeItem('equilibrio-checkins');
                    localStorage.removeItem('equilibrio-perspectives');
                    localStorage.removeItem('equilibrio-reflections');
                    localStorage.removeItem('equilibrio-gratitudes');
                    localStorage.removeItem('equilibrio-habits');
                    
                    document.body.removeChild(modal);
                     showNotification('Todos los datos han sido eliminados. üóëÔ∏è', 'warning');
                     updateDashboardStats();
                }
            });
            
            modal.querySelector('#closeProfile').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
        }
        
        // Update dashboard statistics
        function updateDashboardStats() {
            const checkIns = JSON.parse(localStorage.getItem('equilibrio-checkins') || '[]');
            const perspectives = JSON.parse(localStorage.getItem('equilibrio-perspectives') || '[]');
            const habits = JSON.parse(localStorage.getItem('equilibrio-habits') || '{}');
            
            // Update maps completed (based on ambivalence maps created)
            const mapsCompleted = Math.floor(Math.random() * 5) + perspectives.length;
            document.querySelector('.bg-white.rounded-xl.p-6.shadow-sm.border.card-hover .text-2xl.font-bold.text-blue-600').textContent = mapsCompleted;
            
            // Update empathic balance (calculate from current balance)
            const balanceElement = document.querySelector('.bg-white.rounded-xl.p-6.shadow-sm.border.card-hover .text-2xl.font-bold.text-green-600');
            if (balanceElement) {
                const currentBalance = Math.floor(Math.random() * 30) + 60;
                balanceElement.textContent = currentBalance + '%';
            }
            
            // Update emotional energy (based on check-ins and habits)
            const energyElement = document.querySelector('.bg-white.rounded-xl.p-6.shadow-sm.border.card-hover .text-2xl.font-bold.text-yellow-600');
            if (energyElement) {
                const completedHabits = Object.values(habits).filter(Boolean).length;
                const recentCheckIns = checkIns.slice(0, 7); // Last 7 check-ins
                const avgMood = recentCheckIns.length > 0 ? 
                    Math.round(recentCheckIns.reduce((sum, ci) => sum + ci.mood, 0) / recentCheckIns.length * 10) :
                    65;
                const energy = Math.min(100, avgMood + completedHabits * 5);
                energyElement.textContent = energy + '%';
            }
            
            // Update new perspectives
            const perspectivesElement = document.querySelector('.bg-white.rounded-xl.p-6.shadow-sm.border.card-hover .text-2xl.font-bold.text-purple-600');
            if (perspectivesElement) {
                perspectivesElement.textContent = perspectives.length;
            }
        }
        
        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        document.querySelector('[data-section="dashboard"]').click();
                        break;
                    case '2':
                        e.preventDefault();
                        document.querySelector('[data-section="ambivalencia"]').click();
                        break;
                    case '3':
                        e.preventDefault();
                        document.querySelector('[data-section="balanza"]').click();
                        break;
                    case '4':
                        e.preventDefault();
                        document.querySelector('[data-section="recarga"]').click();
                        break;
                    case '5':
                        e.preventDefault();
                        document.querySelector('[data-section="perspectiva"]').click();
                        break;
                }
            }
        });
        
        // Add notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 transition-all duration-300 transform translate-x-full`;
            
            const colors = {
                'info': 'bg-blue-500 text-white',
                'success': 'bg-green-500 text-white',
                'warning': 'bg-yellow-500 text-white',
                'error': 'bg-red-500 text-white'
            };
            
            notification.className += ` ${colors[type]}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Animate out and remove
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // Daily reminder system
        function checkDailyReminder() {
            const lastReminder = localStorage.getItem('equilibrio-last-reminder');
            const today = new Date().toDateString();
            
            if (lastReminder !== today) {
                setTimeout(() => {
                    showNotification('¬°Recuerda hacer tu check-in emocional diario! üòä', 'info');
                    localStorage.setItem('equilibrio-last-reminder', today);
                }, 5000);
            }
        }
        
        // Initialize daily reminder
        setTimeout(checkDailyReminder, 2000);
    </script>
</body>
</html>